<!DOCTYPE html>
<html>
  <head>
    <title>Admin Announcements</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <style>
      body {
        display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      }

      header {
        background-color: #2f4f81;
        padding: 20px;
        color: #ffffff;
      }

      .announcement-form {
        max-width: 600px;
        margin: 0 auto;
        display: none;
      }

      h2 {
        margin-bottom: 20px;
      }

      label {
        font-weight: bold;
      }

      textarea {
        width: 100%;
        height: 150px;
      }

      .anouncement-btn {
        background-color: #c13438;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .anouncement-btn:hover {
        background-color: #2f4f81;
      }

      button {
        background-color: #c13438;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .link-button{
        background-color: #c13438;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .link-button:hover{
        background-color: #2f4f81;
      }

      button:hover {
        background-color: #2f4f81;
      }

      /* Add a class for styling editable input fields */
      .editable {
        border: 1px solid #ccc;
        padding: 4px;
      }
       /* New CSS rules for editable fields */
    .editable-field {
      background-color: #f2f2f2;
      border: 1px solid #ddd;
      padding: 5px;
    }

    .editable-field.edit-mode {
      background-color: #ffffff;
      border: 1px solid #ccc;
    }
.container{
  flex: 1;
      padding-bottom: 50px;
}
footer{
  background-color: #2f4f81;
      color: #c13438;
      padding: 10px;
      text-align: center;
}

    </style>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#" style="color: #c13438;">
          <img src="ihsa-logo4.png" alt="IHSA Logo" height=50px width=70px class="mr-2">Announcements/Photos
        </a>
  
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="ihsaHome.html">Logout</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <br />
    <br />
    <div class="container">
      <h2>Announcements</h2>
      <button class="anouncement-btn" id="toggleFormBtn">
        Add Announcement
      </button>
      <br /><br />
      <div class="announcement-form" id="announcementForm">
        <h2>Create New Announcement</h2>
        <form>
          <div class="form-group">
            <label for="announcementTitle">Title:</label>
            <input
              type="text"
              class="form-control"
              id="announcementTitle"
              placeholder="Enter title"
            />
          </div>
          <div class="form-group">
            <label for="announcementContent">Content:</label>
            <textarea
              class="form-control"
              id="announcementContent"
              placeholder="Enter announcement content"
            ></textarea>
          </div>
          <button
            type="button"
            class="anouncement-btn"
            onclick="createAnnouncement()"
          >
            Create Announcement
          </button>
        </form>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Content</th>
            <th>Action</th>
            <th>Delete</th>
            <th hidden>ID</th>
          </tr>
        </thead>
        <tbody id="announcementTable">
          <!-- Announcement rows will be added dynamically here -->
        </tbody>
      </table>
      <br /><br />
      <h2>Images</h2>
      <table class="table">
        <thead>
          <tr>
            <th>ImageLink</th>
            <th>Action</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="imagesTable">
          <!-- Image rows will be added dynamically here -->
        </tbody>
      </table>
      <button class="anouncement-btn" id="addImagesBtn" data-toggle="modal" data-target="#imageModal"> Add Images </button>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="imageModalLabel">
              <h5 class="modal-title" id="imageModalLabel">Add Image Link</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="imageLink">Image Link:</label>
                <input type="text" class="form-control" id="imageLink" placeholder="Enter image link"/>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="link-button" onclick="addImageLink()" > Add Image </button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal" > Close </button>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Script for handling announcements and images -->
      <script src="js/announcements.js"></script>
      <script>
        var announcements = [];
        var images = [];
  
        document
          .getElementById("toggleFormBtn")
          .addEventListener("click", function () {
            var announcementForm = document.getElementById("announcementForm");
            if (
              announcementForm.style.display === "none" ||
              announcementForm.style.display === ""
            ) {
              announcementForm.style.display = "block";
            } else {
              announcementForm.style.display = "none";
            }
          });
  
      async function createAnnouncement() {
          var title = document.getElementById("announcementTitle").value;
          var content = document.getElementById("announcementContent").value;
          const urlParams = new URLSearchParams(window.location.search);
          var EventID = urlParams.get('EventID');
          var EventName = urlParams.get('eventname');
          if (title && content && EventID && EventName) {
            const result = await fetch('/addAnnouncement', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                EventID : EventID,
                title : title,
                content : content
            })
        })
        .then((res) => res.json());
        console.log(result);
        if(result.success){
          alert(result.success);
        } else {
          result.error ? alert(result.error) : alert(result.errorMessage);
        }
          //  displayAnnouncements();
            clearFormFields();
            // Hide the announcement form after creating an announcement
            document.getElementById("announcementForm").style.display = "none";
            window.location.reload(true);
          }
        }
  
      async  function addImageLink() {
          var imageLink = document.getElementById("imageLink").value;
          const urlParams = new URLSearchParams(window.location.search);
          var EventID = urlParams.get('EventID');
          var EventName = urlParams.get('eventname');
          if (imageLink && EventID && EventName) {
          const result = await fetch('/addImagesLink', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                EventID : EventID,
                Link : imageLink
            })
        })
        .then((res) => res.json());
        console.log(result); 
        if(result.success){
          alert(result.success);
        } else {
          result.error ? alert(result.error) : alert(result.errorMessage);
        }
            // Close the image modal
            $("#imageModal").modal("hide");
  
            // Clear the image link input field
            document.getElementById("imageLink").value = "";
            window.location.reload(true);
      }
        }
  
        function clearFormFields() {
          document.getElementById("announcementTitle").value = "";
          document.getElementById("announcementContent").value = "";
        }
  
        // Handle the "Add Images" button click event
        document
          .getElementById("addImagesBtn")
          .addEventListener("click", function () {
            // Clear the image link input field when opening the modal
            document.getElementById("imageLink").value = "";
          });
  
      </script>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    </body>
    <footer style="background-color: #2f4f81; color: #c13438; padding: 10px; text-align: center;">
      <p>&copy; IHSA. All rights reserved.</p>
    </footer>
  </html>
  